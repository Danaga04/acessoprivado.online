<!DOCTYPE html><html lang="es"><head>

<!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1325812522225211');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1325812522225211&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->

<script
  src="https://cdn.utmify.com.br/scripts/utms/latest.js"
  data-utmify-prevent-xcod-sck
  data-utmify-prevent-subids
  async
  defer
></script>
     
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Trust Signals</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Poppins','ui-sans-serif','system-ui'] },
                    colors: {
                        brand: {
                            DEFAULT: '#006B54', foreground: '#ffffff',
                            50:'#E6F3F0',100:'#CCE7E1',200:'#99CFC3',300:'#66B7A5',
                            400:'#339F87',500:'#008769',600:'#006B54',700:'#005544',
                            800:'#003E33',900:'#002822'
                        }
                    },
                    boxShadow: { elev: '0 10px 20px rgba(2,6,23,.08), 0 2px 8px rgba(2,6,23,.06)' },
                    borderRadius: { '2xl': '1rem' }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">

    <style>
        .iti { width: 100%; }
        .iti--allow-dropdown .iti__flag-container { left: 0; inset-inline-start: 0; }
        .iti__selected-flag { height: 100%; border-top-left-radius: 12px; border-bottom-left-radius: 12px; padding-inline: 10px !important; }
        .iti__country-list { font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
        #phoneNumber { text-align: center; }
    </style>

    <meta name="theme-color" content="#006B54">
    <meta name="description" content="Trust Signals — validação de sinais de perfil público.">
</head>
<body class="min-h-screen bg-neutral-50 font-sans antialiased selection:bg-brand/10 selection:text-brand-800">
    <div class="h-1 w-full bg-neutral-200">
        <div class="progress h-full w-0 bg-brand transition-[width] duration-500 ease-out"></div>
    </div>

    <main class="container mx-auto max-w-2xl px-4 py-10">
        <div class="flex flex-col items-center gap-2 mb-6">
            <img src="https://i.postimg.cc/yN4HNt92/logo.webp" alt="Trust Signals" class="h-12 w-auto" loading="eager">
            <h1 class="text-3xl font-semibold text-brand-800 leading-none">
                <span class="text-brand">Trust</span>Signals
            </h1>
        </div>

        <div class="bg-white rounded-2xl shadow-elev p-6 border border-neutral-200">
            <div class="text-center space-y-4">
                <h2 id="t-ready" class="text-xl font-semibold text-brand-700" data-i18n="ready">
                    Cansado de Mentiras?
                </h2>

                <p class="text-neutral-900 text-lg font-semibold leading-snug">
                    <span id="t-head-1" class="block" data-i18n="headline1">O Trust Signals revelará</span>
                    <span id="t-head-2" class="block" data-i18n="headline2">a verdade sobre seu parceiro.</span>
                </p>

                <div class="mx-auto flex flex-wrap items-center justify-center gap-3 text-neutral-700">
                    <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-brand/10">
                        <img src="https://i.postimg.cc/yYM5h9dZ/whatsapp-icon.webp" alt="WhatsApp" class="h-6 w-6">
                    </span>
                    <p class="text-base leading-snug text-center">
                        <span class="block sm:inline" id="t-enter-1" data-i18n="enter1">Digite o</span>
                        <span class="block sm:inline">&nbsp;<span class="text-brand font-semibold" id="t-phone" data-i18n="phone">número de telefone</span></span>
                        <span class="block sm:inline" id="t-enter-2" data-i18n="enter2">&nbsp;que deseja espionar</span>
                    </p>
                </div>
            </div>

            <form id="phoneForm" class="mt-6 space-y-4">
                <div class="space-y-2">
                    <div class="mx-auto w-full max-w-md">
                        <input
                            type="tel"
                            id="phoneNumber"
                            required
                            class="w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-[15px] outline-none ring-offset-2 transition
                                   focus:border-brand focus:ring-2 focus:ring-brand/30"
                            placeholder="ex.: 11 91234-5678"
                            autocomplete="tel"
                            inputmode="tel"
                        />
                    </div>
                    <p id="error-msg" class="hidden text-sm text-red-500 text-center"></p>
                </div>

                <div class="mx-auto w-full max-w-md">
                    <button type="submit" id="submitBtn"
                        class="inline-flex w-full items-center justify-center gap-2 rounded-xl bg-brand px-4 py-3 text-[15px] font-semibold text-white
                               shadow-sm transition hover:bg-brand-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/40 disabled:opacity-70">
                        <span class="btn__label" id="t-cta" data-i18n="cta">Espionar agora</span>
                        <svg class="btn__spinner hidden animate-spin h-4 w-4" viewBox="0 0 24 24" fill="none">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                        </svg>
                    </button>
                </div>

                <div class="flex items-center justify-center gap-2 text-sm text-neutral-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-brand" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2a9.99 9.99 0 00-10 10c0 5.523 4.477 10 10 10s10-4.477 10-10A9.99 9.99 0 0012 2zm0 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm2 14h-4v-2h1v-5h-1V9h3v8h1v2z"/>
                    </svg>
                    <p id="t-privacy" data-i18n="privacy">A pessoa não será notificada.</p>
                </div>
            </form>
        </div>

        <p class="mt-6 text-center text-xs text-neutral-500" id="t-terms" data-i18n="terms">
            Ao continuar, você concorda com <br>nossos Termos e Política de Privacidade.
        </p>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"></script>

    <script>
        /* ================= I18N (SEM MT; FALLBACK SEMPRE EN) ================= */
        const ENABLE_MT = false;

        // Cópias multi-idioma
        const I18N = {
            pt: {
                title:'Trust Signals',
                ready:'Cansado de Mentiras?',
                headline1:'O Trust Signals revelará',
                headline2:'a verdade sobre seu parceiro.',
                enter1:'Digite o',
                phone:'número de telefone',
                enter2:'que deseja espionar',
                label:'Número (DDD + número — o código do país já está na bandeira)',
                cta:'Espionar agora',
                privacy:'A pessoa não será notificada.',
                terms:'Ao continuar, você concorda com <br>nossos Termos e Política de Privacidade.',
                errInvalid:'Este número não é válido. Verifique e tente novamente.',
                errRange:'Informe um número nacional válido.',
                ctaLoading:'Pesquisando...'
            },
            en: {
                title:'Trust Signals',
                ready:'Are you tired of lies?',
                headline1:'Trust Signals will reveal',
                headline2:'the truth about your partner.',
                enter1:'Enter the',
                phone:'phone number',
                enter2:'you want to check',
                label:'Number (area code + number — country code is in the flag)',
                cta:'Check now',
                privacy:'The person will not be notified.',
                terms:'By continuing, you agree to our <br>Terms and Privacy Policy.',
                errInvalid:'This number is not valid. Please check and try again.',
                errRange:'Please enter a valid national phone number.',
                ctaLoading:'Searching...'
            },
            es: {
                title:'Trust Signals',
                ready:'¿Cansado de mentiras?',
                headline1:'Trust Signals revelará',
                headline2:'la verdad sobre tu pareja.',
                enter1:'Ingresa el',
                phone:'número de teléfono',
                enter2:'que deseas investigar',
                label:'Número (código de área + número — el código del país está en la bandera)',
                cta:'Investigar ahora',
                privacy:'La persona no será notificada.',
                terms:'Al continuar, aceptas nuestros <br>Términos y Política de Privacidad.',
                errInvalid:'Este número no es válido. Revisa e inténtalo de nuevo.',
                errRange:'Introduce un número nacional válido.',
                ctaLoading:'Buscando...'
            },
            'es-mx': {
                title:'Trust Signals',
                ready:'¿Cansado de mentiras?',
                headline1:'Trust Signals revelará',
                headline2:'la verdad sobre tu pareja.',
                enter1:'Escribe el',
                phone:'número de teléfono',
                enter2:'que quieres investigar',
                label:'Número (lada + número — el código del país está en la bandera)',
                cta:'Investigar ahora',
                privacy:'La persona no será notificada.',
                terms:'Al continuar, aceptas nuestros <br>Términos y Aviso de Privacidad.',
                errInvalid:'Número no válido. Verifica e inténtalo de nuevo.',
                errRange:'Escribe un número nacional válido.',
                ctaLoading:'Buscando...'
            },
            fr: {
                title:'Trust Signals',
                ready:'Marre des mensonges ?',
                headline1:'Trust Signals révélera',
                headline2:'la vérité sur votre partenaire.',
                enter1:'Saisissez le',
                phone:'numéro de téléphone',
                enter2:'que vous souhaitez vérifier',
                label:'Numéro (indicatif + numéro — le code pays est dans le drapeau)',
                cta:'Vérifier maintenant',
                privacy:'La personne ne sera pas informée.',
                terms:'En continuant, vous acceptez nos <br>Conditions et Politique de confidentialité.',
                errInvalid:'Numéro invalide. Veuillez vérifier et réessayer.',
                errRange:'Saisissez un numéro national valide.',
                ctaLoading:'Recherche...'
            },
            de: {
                title:'Trust Signals',
                ready:'Genug von Lügen?',
                headline1:'Trust Signals deckt auf,',
                headline2:'was Ihr Partner wirklich verheimlicht.',
                enter1:'Geben Sie die',
                phone:'Telefonnummer',
                enter2:'ein, die Sie prüfen möchten',
                label:'Nummer (Vorwahl + Nummer — Ländercode ist in der Flagge)',
                cta:'Jetzt prüfen',
                privacy:'Die Person wird nicht benachrichtigt.',
                terms:'Mit dem Fortfahren akzeptieren Sie unsere <br>Nutzungsbedingungen und Datenschutzrichtlinie.',
                errInvalid:'Diese Nummer ist ungültig. Bitte prüfen und erneut versuchen.',
                errRange:'Bitte geben Sie eine gültige nationale Rufnummer ein.',
                ctaLoading:'Suche...'
            },
            ru: {
                title:'Trust Signals',
                ready:'Устали от лжи?',
                headline1:'Trust Signals раскроет',
                headline2:'правду о вашем партнере.',
                enter1:'Введите',
                phone:'номер телефона',
                enter2:'который хотите проверить',
                label:'Номер (код города + номер — код страны в флаге)',
                cta:'Проверить сейчас',
                privacy:'Человек не будет уведомлен.',
                terms:'Продолжая, вы соглашаетесь с нашими <br>Условиями и Политикой конфиденциальности.',
                errInvalid:'Неверный номер. Проверьте и повторите попытку.',
                errRange:'Введите действительный национальный номер.',
                ctaLoading:'Поиск...'
            },
            zh: {
                title:'Trust Signals',
                ready:'厌倦谎言了吗？',
                headline1:'Trust Signals 将揭示',
                headline2:'你伴侣的真实情况。',
                enter1:'输入你想要',
                phone:'查询的电话号码',
                enter2:'',
                label:'号码（区号 + 本机号码——国家区号在国旗中）',
                cta:'立即查询',
                privacy:'对方不会收到任何通知。',
                terms:'继续即表示你同意我们的<br>条款与隐私政策。',
                errInvalid:'号码无效，请检查后重试。',
                errRange:'请输入有效的本地号码。',
                ctaLoading:'查询中...'
            },
            sk: {
                title:'Trust Signals',
                ready:'Už máte dosť klamstiev?',
                headline1:'Trust Signals odhalí',
                headline2:'pravdu o vašom partnerovi.',
                enter1:'Zadajte',
                phone:'telefónne číslo',
                enter2:'ktoré chcete skontrolovať',
                label:'Číslo (predvoľba + číslo — kód krajiny je pri vlajke)',
                cta:'Skontrolovať teraz',
                privacy:'Osoba nebude upozornená.',
                terms:'Pokračovaním súhlasíte s našimi <br>Podmienkami a Zásadami ochrany súkromia.',
                errInvalid:'Neplatné číslo. Skontrolujte a skúste znova.',
                errRange:'Zadajte platné národné číslo.',
                ctaLoading:'Vyhľadávanie...'
            },
            ar: {
                title:'Trust Signals',
                ready:'هل سئمت من الأكاذيب؟',
                headline1:'سيكشف Trust Signals',
                headline2:'الحقيقة عن شريكك.',
                enter1:'أدخل',
                phone:'رقم الهاتف',
                enter2:'الذي تريد التحقق منه',
                label:'الرقم (رمز المنطقة + الرقم — رمز الدولة موجود عند العلم)',
                cta:'افحص الآن',
                privacy:'لن يتم إشعار الطرف الآخر.',
                terms:'بالمتابعة فإنك توافق على <br>الشروط وسياسة الخصوصية.',
                errInvalid:'الرقم غير صالح. يرجى المراجعة والمحاولة مرة أخرى.',
                errRange:'يرجى إدخال رقم محلي صالح.',
                ctaLoading:'جارٍ البحث...'
            }
        };

        const COUNTRY_TO_LANG = {
            // Américas
            US:'en', CA:'en', MX:'es-mx', BR:'pt', AR:'es', CL:'es', CO:'es', PE:'es', VE:'es', UY:'es', PY:'es', BO:'es', EC:'es',
            // Europa Oc/Set/Norte
            GB:'en', IE:'en', FR:'fr', ES:'es', PT:'pt', DE:'de', AT:'de', CH:'de', BE:'fr', NL:'nl',
            IT:'it',
            // Leste/Balcãs (exemplos)
            SK:'sk', CZ:'cs', PL:'pl', RO:'ro', HU:'hu', RU:'ru', UA:'uk',
            // Oriente Médio / Norte da África
            SA:'ar', AE:'ar', EG:'ar', MA:'ar',
            // Ásia
            CN:'zh', HK:'zh', TW:'zh', JP:'ja', KR:'ko',
            // Oceania
            AU:'en', NZ:'en'
        };

        const RTL_LANGS = new Set(['ar']);

        function applyStrings(dict){
            document.title = dict.title || 'Trust Signals';
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (!key || !(key in dict)) return;
                if (key === 'terms') el.innerHTML = dict[key];
                else el.textContent = dict[key];
            });
        }

        function setDirForLang(lang){
            if (RTL_LANGS.has(lang)) { document.documentElement.dir = 'rtl'; }
            else { document.documentElement.dir = 'ltr'; }
        }

        function loadLang(lang){
            lang = (lang || 'en').toLowerCase();
            document.documentElement.lang = lang;
            setDirForLang(lang);
            const dict = I18N[lang] || I18N['en'];
            applyStrings(dict);
        }

        /* ================= FETCH c/ TIMEOUT ================= */
        function fetchWithTimeout(resource, options = {}) {
            const { timeout = 15000 } = options;
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            return fetch(resource, { ...options, signal: controller.signal })
                .finally(() => clearTimeout(id));
        }

        /* ================== DOM REFS ================== */
        const phoneInput = document.querySelector("#phoneNumber");
        const errorMsg   = document.querySelector("#error-msg");
        const submitBtn  = document.querySelector("#submitBtn");
        const progressBar= document.querySelector(".progress");
        const btnSpinner = submitBtn.querySelector(".btn__spinner");
        const btnLabel   = submitBtn.querySelector(".btn__label");

        /* =========== INTL-TEL-INPUT (DDD + número; sem DDI no campo) =========== */
        const iti = window.intlTelInput(phoneInput, {
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
            preferredCountries: ["br","us","gb","mx","de","fr","ru","cn","es","pt","sk","sa","ae","au","ca","cl","co","ar","it","jp","kr"],
            separateDialCode: true,
            // Mostra DDI fixo na bandeira
            nationalMode: true,
            // Campo aceita apenas formato nacional (DDD + número)
            autoPlaceholder: "aggressive",
            formatOnDisplay: true,
            autoHideDialCode: false
        });

        // Ajuste de placeholder para não exibir +DDI
        function refreshPlaceholder(){
            try {
                const iso2 = iti.getSelectedCountryData().iso2;
                const example = window.intlTelInputUtils.getExampleNumber(iso2, true);
                if (example) {
                    const cleaned = example.replace(/^\+\d+\s*/, '');
                    phoneInput.setAttribute('placeholder', cleaned);
                }
            } catch {}
        }

        // Formatação suave enquanto digita (nacional)
        let formatting = false;
        phoneInput.addEventListener('input', () => {
            if (!window.intlTelInputUtils || formatting) return;
            try {
                formatting = true;
                const formattedNational = iti.getNumber(intlTelInputUtils.numberFormat.NATIONAL);
                if (formattedNational && formattedNational !== phoneInput.value) {
                    phoneInput.value = formattedNational;
                    phoneInput.setSelectionRange(formattedNational.length, formattedNational.length);
                }
            } catch {} finally { formatting = false; }

            if (iti.isValidNumber()) hideError();
        });

        // Pré-seleciona país por IP e carrega idioma (fallback sempre EN)
        (async () => {
            try {
                const res = await fetch('https://ipapi.co/json/');
                if (!res.ok) throw new Error('geo fail');
                const data = await res.json();
                const iso2 = (data?.country_code || '').toLowerCase();
                if (iso2) iti.setCountry(iso2);
                const lang = (function(cc){ const l = COUNTRY_TO_LANG[cc?.toUpperCase()]; return I18N[l]?l:'en'; })(data?.country_code);
                loadLang(lang);
            } catch {
                loadLang('en');
            }
            refreshPlaceholder();
        })();

        // Troca idioma e placeholder ao trocar bandeira
        phoneInput.addEventListener('countrychange', () => {
            try {
                const iso2 = iti.getSelectedCountryData().iso2;
                const cc = iso2 ? iso2.toUpperCase() : 'US';
                const lang = (function(cc){ const l = COUNTRY_TO_LANG[cc]; return I18N[l]?l:'en'; })(cc);
                loadLang(lang);
            } catch { loadLang('en'); }
            refreshPlaceholder();
            // Após trocar país, se já estiver longo, aplicamos o limite
            setTimeout(enforceMaxLengthIfNeeded, 0);
        });

        /* ================== UI Helpers ================== */
        function tkey(key){
            const lang = (document.documentElement.lang || 'en').toLowerCase();
            const dict = I18N[lang] || I18N['en'];
            return dict[key] || (I18N['en'][key] || '');
        }
        function showError(msg){
            errorMsg.classList.remove("hidden");
            errorMsg.textContent = msg;
            phoneInput.classList.remove("border-neutral-300");
            phoneInput.classList.add("border-red-400");
        }
        function hideError(){
            errorMsg.classList.add("hidden");
            phoneInput.classList.remove("border-red-400");
            phoneInput.classList.add("border-neutral-300");
        }
        function setLoading(state){
            if (state){
                btnSpinner.classList.remove("hidden");
                btnLabel.textContent = tkey('ctaLoading');
                submitBtn.disabled = true;
                progressBar.style.width = "100%";
            } else {
                btnSpinner.classList.add("hidden");
                btnLabel.textContent = tkey('cta');
                submitBtn.disabled = false;
            }
        }

        /* ================== LIMITADOR POR PAÍS (não altera o submit) ================== */
        // Corta dígitos excedentes conforme validação libphonenumber (TOO_LONG)
        let __trimming = false;
        function enforceMaxLengthIfNeeded(){
            if (__trimming) return;
            if (!window.intlTelInputUtils || typeof iti.getValidationError !== 'function') return;

            const VERR = window.intlTelInputUtils.validationError;
            let err = iti.getValidationError();
            if (err !== VERR.TOO_LONG) return;

            __trimming = true;
            try {
                const data = iti.getSelectedCountryData();
                const dial = (data && data.dialCode) ? String(data.dialCode) : '';
                // pega apenas dígitos nacionais do input atual
                let digits = (phoneInput.value || '').replace(/\D+/g, '');
                let guard = 0;
                while (digits.length > 0 && guard < 50) {
                    // usa setNumber para reformatar respeitando nationalMode
                    iti.setNumber('+' + dial + digits);
                    err = iti.getValidationError();
                    if (err !== VERR.TOO_LONG) break;
                    digits = digits.slice(0, -1); // remove 1 dígito e reavalia
                    guard++;
                }
            } catch(_) {} finally {
                __trimming = false;
            }
        }
        // Eventos: digitação, colagem e troca de país
        phoneInput.addEventListener('input', () => { requestAnimationFrame(enforceMaxLengthIfNeeded); });
        phoneInput.addEventListener('paste', () => setTimeout(enforceMaxLengthIfNeeded, 0));

        /* ================== SUBMIT ================== */
        document.getElementById("phoneForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            if (!iti.isValidNumber()) { showError(tkey('errInvalid')); return; }

            // E.164 com DDI (ex.: +5511912345678)
            const e164 = iti.getNumber(intlTelInputUtils.numberFormat.E164) || '';
            if (!e164) { showError(tkey('errRange')); return; }

            hideError();
            setLoading(true);

            // 1. Número para o back-end (com +)
            const cleanedDigits = e164.replace(/\D+/g, ''); // 5511912345678

            // 2. Número para a URL (sem + e sem URL-encoding)
            const urlNumber = cleanedDigits; // Ex: 5511912345678

            // Pega as UTMS da URL atual
            const currentUrl = new URL(window.location.href);
            let utmParams = '';
            for (const [key, value] of currentUrl.searchParams.entries()) {
                // Adiciona apenas os parâmetros de UTM e relacionados, e os codifica
                if (key.startsWith('utm_') || ['source', 'medium', 'campaign', 'content', 'term'].includes(key)) {
                    utmParams += `&${key}=${encodeURIComponent(value)}`;
                }
            }

            // Construção da URL de redirecionamento: https://acessoprivado.online/etapa2/?tel=...&utms
            // O urlNumber não é codificado, mas os demais parâmetros são
            const redirectUrl = `https://acessoprivado.online/etapa2/?tel=${urlNumber}${utmParams}`;


            // Lógica original de chamada de API e salvamento de dados (mantida, mas o redirecionamento é no finally)
            localStorage.setItem("phoneNumber", cleanedDigits); // Salva o número (sem +)

            try {
                // Chamada de API usa o E.164 SEM o '+' para este endpoint específico,
                // que é o formato 'cleanedDigits' (5511912345678)
                const r = await fetchWithTimeout("../api-whatsapp.php", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ tel: cleanedDigits }),
                    timeout: 15000
                });
                if (r.ok) {
                    const resp = await r.json();
                    const photo =
                        resp?.photoUrl ||
                        resp?.photoDataUrl ||
                        resp?.raw?.data?.link ||
                        resp?.raw?.profile_pic_url ||
                        resp?.raw?.picture || null;

                    if (typeof photo === "string" && (/^https?:\/\//i.test(photo) || /^data:image\//i.test(photo))) {
                        localStorage.setItem("whatsappProfilePicUrl", photo);
                    }
                }
            } catch (_) {
                // silencioso; Step 2 fará fallback se preciso
            } finally {
                // ActiveCampaign em background (mantido)
                try {
                    const acPayload = JSON.stringify({ phone: cleanedDigits });
                    fetch("./save.php", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: acPayload,
                        keepalive: true
                    }).catch(()=>{});
                    if (navigator.sendBeacon) {
                        const blob = new Blob([acPayload], { type: "application/json" });
                        navigator.sendBeacon("./save.php", blob);
                    }
                } catch(_){}

                // Redirecionamento modificado (sem %2B)
                window.location.href = redirectUrl;
            }
        });

        phoneInput.addEventListener("input", () => {
            if (iti.isValidNumber()) hideError();
            else errorMsg.classList.add("hidden");
        });
    </script>

</body>
</html>

